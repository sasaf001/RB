<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to HR-Test-App</title>
</head>
<body>
    <h2>Welcome to HR-Test-App</h2>
    <form id="userForm">
        <label for="login">Login:</label>
        <input type="email" id="login" name="login" required><br><br>
        
        <label for="firstName">Vorname:</label>
        <input type="text" id="firstName" name="firstName"><br><br>
        
        <label for="lastName">Nachname:</label>
        <input type="text" id="lastName" name="lastName"><br><br>

        <input type="button" value="Abrufen" onclick="fetchUserData()">
        <input type="button" value="Aktualisieren" onclick="updateUserData()">
    </form>

    <script>
        async function fetchUserData() {
            const login = document.getElementById('login').value.trim();
            if (!login) {
                alert("Bitte geben Sie eine Login-E-Mail-Adresse ein.");
                return;
            }

            const encodedLogin = encodeURIComponent(login);

            try {
                const response = await fetch(`https://demo-green-puma-81717.okta.com/api/v1/users/${encodedLogin}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': 'SSWS 00pKU38MmlaAOr-_c7UDha06cUcl0krxY76vLPVtwh',
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    const userData = await response.json();
                    console.log("Benutzerdaten erhalten:", userData);

                    // FÃ¼lle die Formularfelder mit den Benutzerdaten
                    if (userData.profile) {
                        document.getElementById('firstName').value = userData.profile.firstName || "";
                        document.getElementById('lastName').value = userData.profile.lastName || "";
                    }
                } else {
                    console.error("Fehler beim Abrufen:", response.status, await response.text());
                    alert("Fehler beim Abrufen der Benutzerdaten.");
                }
            } catch (error) {
                console.error("Fehler beim Abruf:", error);
                alert("Es gab ein Problem mit der Verbindung.");
            }
        }

        async function updateUserData() {
            const login = document.getElementById('login').value.trim();
            if (!login) {
                alert("Bitte geben Sie eine Login-E-Mail-Adresse ein.");
                return;
            }

            const encodedLogin = encodeURIComponent(login);

            const userData = {
                profile: {
                    firstName: document.getElementById('firstName').value.trim(),
                    lastName: document.getElementById('lastName').value.trim(),
                }
            };

            try {
                const response = await fetch(`https://demo-green-puma-81717.okta.com/api/v1/users/${encodedLogin}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'SSWS 00pKU38MmlaAOr-_c7UDha06cUcl0krxY76vLPVtwh',
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                if (response.ok) {
                    alert('Benutzerdaten erfolgreich aktualisiert.');
                } else {
                    console.error("Fehler beim Aktualisieren:", response.status, await response.text());
                    alert('Fehler beim Aktualisieren der Benutzerdaten.');
                }
            } catch (error) {
                console.error("Fehler beim Update:", error);
                alert("Es gab ein Problem mit der Verbindung.");
            }
        }
    </script>
</body>
</html>
